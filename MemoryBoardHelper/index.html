<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Memory Board Helper - CraftKontrol</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    <!-- Leaflet CSS for OpenStreetMap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a1a">
</head>
<body>
    <header class="header">
        <div class="header-title">
            <div>    
            <h1 id="appTitle">Memory Board Helper</h1>
            <p id="appSubtitle">Votre assistant mémoire intelligent</p>
            </div>
            <button class="icon-btn" onclick="openSettingsModal()" title="Paramètres">
                <span class="material-symbols-outlined">settings</span>
            </button>
        </div>
        <div class="header-controls">
            
            <div class="mode-toggle">
                <button id="modeToggleBtn" class="mode-btn" onclick="toggleListeningMode()">
                    <span class="material-symbols-outlined" id="modeIcon">mic_off</span>
                    <span id="modeText">Mode Manuel</span>
                </button>
            </div>
            <div class="emergency-quick-access">
                <button class="emergency-btn" onclick="toggleEmergencyPanel()">
                    <span class="material-symbols-outlined">local_hospital</span>
                    <span id="emergencyBtnText">Urgence</span>
                </button>
            </div>
        </div>
        <div class="credits">
            <span>CraftKontrol © 2025</span>
            <div class="last-modified">
                <span id="lastModified">Chargement...</span>
            </div>
        </div>
    </header>

    <main class="main-content">
                <!-- Modale de sélection du son d'alarme -->
                <div id="alarmSoundModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2><span class="material-symbols-outlined">alarm</span> Choisir le son d'alarme</h2>
                            <button class="close-btn" onclick="closeAlarmSoundModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="input-group">
                                <label for="alarmSoundSelect">Son d'alarme :</label>
                                <select id="alarmSoundSelect">
                                    <option value="gentle-alarm.mp3">Alarme douce (gentle-alarm.mp3)</option>
                                    <option value="chime-alarm.mp3">Carillon (chime-alarm.mp3)</option>
                                    <option value="bell-alarm.mp3">Cloche (bell-alarm.mp3)</option>
                                    <option value="soft-beep.mp3">Bip doux (soft-beep.mp3)</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeAlarmSoundModal()">Annuler</button>
                            <button class="btn-primary" onclick="saveAlarmSound()">Enregistrer</button>
                        </div>
                    </div>
                </div>

        <!-- Modale des Préférences -->
        <div id="settingsModal" class="modal" style="display: none;">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2><span class="material-symbols-outlined">settings</span> Préférences</h2>
                    <button class="close-btn" onclick="closeSettingsModal()">×</button>
                </div>
                <div class="modal-body">
                    <!-- Wake Word Settings -->
                    <div class="settings-section">
                        <h3><span class="material-symbols-outlined">chat</span> Mot de réveil</h3>
                        <div class="input-group">
                            <label for="settingsWakeWord">Mot de réveil personnalisé :</label>
                            <input type="text" id="settingsWakeWord" placeholder="Ex: Bonjour, Salut...">
                        </div>
                        <div class="input-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="settingsWakeWordEnabled">
                                <span>Activer le mot de réveil</span>
                            </label>
                        </div>
                    </div>

                    <!-- Alarm Sound Settings -->
                    <div class="settings-section">
                        <h3><span class="material-symbols-outlined">alarm</span> Son d'alarme</h3>
                        <div class="input-group">
                            <label for="settingsAlarmSound">Son d'alarme :</label>
                            <select id="settingsAlarmSound">
                                <option value="gentle-alarm.mp3">Alarme douce (gentle-alarm.mp3)</option>
                                <option value="chime-alarm.mp3">Carillon (chime-alarm.mp3)</option>
                                <option value="bell-alarm.mp3">Cloche (bell-alarm.mp3)</option>
                                <option value="soft-beep.mp3">Bip doux (soft-beep.mp3)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Auto-play TTS -->
                    <div class="settings-section">
                        <h3><span class="material-symbols-outlined">volume_up</span> Audio</h3>
                        <div class="input-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="settingsAutoPlayTTS">
                                <span>Lecture automatique des réponses vocales</span>
                            </label>
                        </div>
                    </div>

                    <!-- SSML Settings -->
                    <div class="settings-section">
                        <h3><span class="material-symbols-outlined">mic</span> SSML (Modulation vocale avancée)</h3>
                        <div class="input-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="settingsSsmlEnabled">
                                <span>Activer SSML</span>
                            </label>
                        </div>
                        <div class="input-group">
                            <label for="settingsCustomKeywords">Mots-clés personnalisés (séparés par virgules) :</label>
                            <input type="text" id="settingsCustomKeywords" placeholder="important, urgent, attention...">
                        </div>
                    </div>

                    <!-- Sound System Settings -->
                    <div class="settings-section">
                        <h3><span class="material-symbols-outlined">volume_up</span> Système de Sons UI</h3>
                        <div class="input-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="settingsSoundEnabled" checked>
                                <span>Activer les sons d'interface</span>
                            </label>
                        </div>
                        <div class="input-group">
                            <label for="settingsSoundVolume">Volume des sons : <span id="soundVolumeValue">70%</span></label>
                            <input type="range" id="settingsSoundVolume" min="0" max="100" value="70" oninput="updateSoundVolumeDisplay(this.value)">
                        </div>
                        <div class="input-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="settingsHapticEnabled" checked>
                                <span>Activer les vibrations haptiques</span>
                            </label>
                        </div>
                        <div class="input-group">
                            <button class="btn-secondary" onclick="testSoundSystem()">
                                <span class="material-symbols-outlined">play_circle</span>
                                Tester les sons
                            </button>
                        </div>
                        <p class="hint" style="margin-top: 10px;">
                            <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">info</span>
                            Les sons varient selon le type d'action et la fréquence d'utilisation
                        </p>
                    </div>

                    <!-- Logs -->
                    <div class="settings-section">
                        <h3><span class="material-symbols-outlined">description</span> Logs</h3>
                        <div class="input-group">
                            <button class="btn-secondary" onclick="viewLogs()">Voir les logs</button>
                            <button class="btn-secondary" onclick="clearLogs()">Effacer les logs</button>
                        </div>
                    </div>

                    <!-- Reset Section -->
                    <div class="settings-section settings-danger">
                        <h3><span class="material-symbols-outlined">warning</span> Zone dangereuse</h3>
                        <p class="warning-text">Cette action réinitialisera tous les paramètres à leurs valeurs par défaut et supprimera toutes les données sauvegardées.</p>
                        <button class="btn-danger" onclick="resetAllSettings()">Réinitialiser tous les paramètres</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeSettingsModal()">Annuler</button>
                    <button class="btn-primary" onclick="saveSettings()">Enregistrer</button>
                </div>
            </div>
        </div>

        

        <!-- Emergency Contacts Panel -->
        <section class="emergency-panel" id="emergencyPanel" style="display: none;">
            <div class="emergency-header">
                <h2>
                    <span class="material-symbols-outlined">emergency</span>
                    <span id="emergencyTitle">Contacts d'Urgence</span>
                </h2>
                <button class="close-btn" onclick="toggleEmergencyPanel()">×</button>
            </div>
            <div class="emergency-contacts">
                <div class="contact-card" id="contact1Card" style="display: none;">
                    <div class="contact-info">
                        <h3 id="contact1Name">Contact 1</h3>
                        <p id="contact1Phone">+33 6 00 00 00 00</p>
                        <p id="contact1Relation">Famille</p>
                    </div>
                    <button class="btn-call" onclick="callEmergencyContact(1)">
                        <span class="material-symbols-outlined">call</span>
                        <span id="callBtn1">Appeler</span>
                    </button>
                </div>
                <div class="contact-card" id="contact2Card" style="display: none;">
                    <div class="contact-info">
                        <h3 id="contact2Name">Contact 2</h3>
                        <p id="contact2Phone">+33 6 00 00 00 00</p>
                        <p id="contact2Relation">Médecin</p>
                    </div>
                    <button class="btn-call" onclick="callEmergencyContact(2)">
                        <span class="material-symbols-outlined">call</span>
                        <span id="callBtn2">Appeler</span>
                    </button>
                </div>
                <div class="contact-card" id="contact3Card" style="display: none;">
                    <div class="contact-info">
                        <h3 id="contact3Name">Contact 3</h3>
                        <p id="contact3Phone">15</p>
                        <p id="contact3Relation">SAMU</p>
                    </div>
                    <button class="btn-call" onclick="callEmergencyContact(3)">
                        <span class="material-symbols-outlined">call</span>
                        <span id="callBtn3">Appeler</span>
                    </button>
                </div>
            </div>
            <button class="btn-secondary" onclick="openEmergencySettings()" id="configureContactsBtn">Configurer les contacts</button>
        </section>



        
        <!-- Modale de configuration des contacts d'urgence -->
        <div id="emergencySettingsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><span class="material-symbols-outlined">settings</span> Configurer les contacts d'urgence</h2>
                    <button class="close-btn" onclick="closeEmergencySettings()">×</button>
                </div>
                <div class="modal-body">
                    <div id="contactInputs">
                        <div class="contact-config" id="contactConfig1">
                            <div class="input-group">
                                <label for="contact1NameInput">Nom du contact :</label>
                                <input type="text" id="contact1NameInput" placeholder="Nom...">
                            </div>
                            <div class="input-group">
                                <label for="contact1PhoneInput">Téléphone :</label>
                                <input type="text" id="contact1PhoneInput" placeholder="Téléphone...">
                            </div>
                            <div class="input-group">
                                <label for="contact1RelationInput">Relation :</label>
                                <input type="text" id="contact1RelationInput" placeholder="Relation...">
                            </div>
                            <button class="btn-delete-contact" type="button" onclick="deleteEmergencyContact(1)">Effacer</button>
                        </div>
                        <div class="contact-config" id="contactConfig2" style="display:none;">
                            <hr>
                            <div class="input-group">
                                <label for="contact2NameInput">Nom du contact :</label>
                                <input type="text" id="contact2NameInput" placeholder="Nom...">
                            </div>
                            <div class="input-group">
                                <label for="contact2PhoneInput">Téléphone :</label>
                                <input type="text" id="contact2PhoneInput" placeholder="Téléphone...">
                            </div>
                            <div class="input-group">
                                <label for="contact2RelationInput">Relation :</label>
                                <input type="text" id="contact2RelationInput" placeholder="Relation...">
                            </div>
                            <button class="btn-delete-contact" type="button" onclick="deleteEmergencyContact(2)">Effacer</button>
                        </div>
                        <div class="contact-config" id="contactConfig3" style="display:none;">
                            <hr>
                            <div class="input-group">
                                <label for="contact3NameInput">Nom du contact :</label>
                                <input type="text" id="contact3NameInput" placeholder="Nom...">
                            </div>
                            <div class="input-group">
                                <label for="contact3PhoneInput">Téléphone :</label>
                                <input type="text" id="contact3PhoneInput" placeholder="Téléphone...">
                            </div>
                            <div class="input-group">
                                <label for="contact3RelationInput">Relation :</label>
                                <input type="text" id="contact3RelationInput" placeholder="Relation...">
                            </div>
                            <button class="btn-delete-contact" type="button" onclick="deleteEmergencyContact(3)">Effacer</button>
                        </div>
                    </div>
                    <div class="contact-actions">
                        <button class="btn-secondary" id="addContactBtn" onclick="addEmergencyContact()">Ajouter un contact</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeEmergencySettings()">Annuler</button>
                    <button class="btn-primary" onclick="saveEmergencyContacts()">Enregistrer</button>
                </div>
            </div>
        </div>

        <section class="time-display">
            <h2>
                <span class="material-symbols-outlined">schedule</span>
                <span id="timeDisplayTitle">Heure actuelle</span>
               
            </h2>
            <div id="timeDisplayContent" class="section-content">
                <div class="current-time">
                    <span class="material-symbols-outlined">schedule</span>
                    <div class="time-info">
                        <div id="currentTime" class="time-text" tabindex="0">00:00</div>
                        <div id="currentDate" class="date-text">Chargement...</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="voice-interaction">
            <h2>
                <span class="material-symbols-outlined">mic</span>
                <span id="voiceInteractionTitle">Interaction vocale</span>
                <button class="section-toggle" onclick="toggleSection('voiceInteractionContent')" id="voiceToggleBtn">Masquer</button>
            </h2>
            <div id="voiceInteractionContent" class="section-content">
            <div class="voice-status">
                <div class="status-indicator" id="voiceStatus">
                    <span class="material-symbols-outlined" id="voiceStatusIcon">mic_off</span>
                    <span id="voiceStatusText">Mode vocal désactivé</span>
                </div>
                <div class="listening-indicator" id="listeningIndicator" style="display: none;">
                    <div class="pulse"></div>
                    <span id="listeningText">Écoute en cours...</span>
                </div>
                <div class="wake-word-indicator" id="wakeWordIndicator" style="display: none;">
                    <span class="material-symbols-outlined">chat</span>
                    <span id="wakeWordIndicatorText">Je vous écoute...</span>
                </div>
            </div>

            <div class="voice-controls">
                <button class="btn-voice-large" id="voiceBtn" onclick="handleVoiceInteraction()">
                    <span class="material-symbols-outlined">mic</span>
                    <span id="voiceBtnText">Appuyez pour parler</span>
                </button>
            </div>

            <!-- Spectrum VU Meter -->
            <div class="spectrum-container" id="spectrumContainer" style="display: none;">
                <canvas id="spectrumCanvas" class="spectrum-canvas"></canvas>
            </div>

            <div class="voice-transcript" id="voiceTranscript" style="display: none;">
                <p id="transcriptText"></p>
            </div>

            <div class="voice-response" id="voiceResponse" style="display: none;">
                <div class="response-header">
                    <span class="material-symbols-outlined">smart_toy</span>
                    <span id="assistantLabel">Assistant</span>
                </div>
                <p id="responseText"></p>
            </div>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="successMessage" class="success-message" style="display: none;"></div>
        </section>

        <!-- Activity Tracking Section -->
        <section class="activity-section">
            <div class="activity-header">
                <h2>
                    <span class="material-symbols-outlined">directions_run</span>
                    <span id="activityTitle">Activités & Exercices</span>
                </h2>
                <button class="section-toggle" onclick="toggleSection('activityContent')" id="activityToggleBtn">Masquer</button>
            </div>
            <div id="activityContent" class="section-content">
                <!-- Today's Summary Dashboard -->
                <div class="activity-dashboard">
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <span class="material-symbols-outlined">footprint</span>
                            <div class="card-content">
                                <span class="card-label" id="stepsLabel">Pas</span>
                                <span class="card-value" id="todaySteps">0</span>
                            </div>
                        </div>
                        <div class="dashboard-card">
                            <span class="material-symbols-outlined">route</span>
                            <div class="card-content">
                                <span class="card-label" id="distanceLabel">Distance</span>
                                <span class="card-value" id="todayDistance">0 m</span>
                            </div>
                        </div>
                        <div class="dashboard-card">
                            <span class="material-symbols-outlined">local_fire_department</span>
                            <div class="card-content">
                                <span class="card-label" id="caloriesLabel">Calories</span>
                                <span class="card-value" id="todayCalories">0</span>
                            </div>
                        </div>
                        <div class="dashboard-card">
                            <span class="material-symbols-outlined">timer</span>
                            <div class="card-content">
                                <span class="card-label" id="durationLabel">Durée</span>
                                <span class="card-value" id="todayDuration">0s</span>
                            </div>
                        </div>
                    </div>

                    <!-- Steps Goal Progress -->
                    <div class="goal-progress-container">
                        <div class="goal-header">
                            <span id="goalLabel">Objectif de pas quotidien</span>
                            <span id="stepsGoalText">0 / 10,000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="stepsProgress" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Weekly Steps Chart -->
                    <div class="weekly-chart-container">
                        <h3 id="weeklyStepsTitle">Pas - 7 derniers jours</h3>
                        <canvas id="weeklyStepsChart" width="700" height="200"></canvas>
                    </div>
                </div>

                <!-- View Options -->
                <div class="activity-view-options">
                    <button class="btn-view-option" id="viewPathsBtn">
                        <span class="material-symbols-outlined">map</span>
                        <span id="viewPathsLabel">Voir mes parcours</span>
                    </button>
                    <button class="btn-view-option" id="viewStatsBtn">
                        <span class="material-symbols-outlined">bar_chart</span>
                        <span id="viewStatsLabel">Statistiques complètes</span>
                    </button>
                </div>
            </div>
        </section>

        <section class="calendar-section">
            <div class="calendar-header">
                <h2>
                    <span class="material-symbols-outlined">calendar_month</span>
                    <span id="calendarTitle">Mon Calendrier</span>
                </h2>
                <button class="section-toggle" onclick="toggleSection('calendarContent')" id="calendarToggleBtn">Masquer</button>
            </div>
            <div id="calendarContent" class="section-content">
                <div class="calendar-controls">
                    <button class="btn-calendar-control" onclick="calendarToday()" title="Aujourd'hui">
                        <span class="material-symbols-outlined">today</span>
                    </button>
                    <button class="btn-calendar-control" onclick="calendarPrev()" title="Précédent">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <button class="btn-calendar-control" onclick="calendarNext()" title="Suivant">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                    <div class="view-selector">
                        <button class="btn-view" onclick="changeCalendarView('listWeek')" data-view="listWeek" title="Liste">
                            <span class="material-symbols-outlined">list</span>
                        </button>
                        <button class="btn-view" onclick="changeCalendarView('dayGridMonth')" data-view="dayGridMonth" title="Mois">
                            <span class="material-symbols-outlined">calendar_month</span>
                        </button>
                        <button class="btn-view" onclick="changeCalendarView('timeGridWeek')" data-view="timeGridWeek" title="Semaine">
                            <span class="material-symbols-outlined">view_week</span>
                        </button>
                        <button class="btn-view" onclick="changeCalendarView('timeGridDay')" data-view="timeGridDay" title="Jour">
                            <span class="material-symbols-outlined">today</span>
                        </button>
                    </div>
                </div>

                <div id="loadingCalendar" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p id="loadingCalendarText">Chargement du calendrier...</p>
                </div>

                <div id="calendarContainer"></div>

                <button class="btn-add-task" onclick="openAddTaskModal()" id="addTaskBtn">
                    <span class="material-symbols-outlined">add_circle</span>
                    <span id="addTaskBtnText">Ajouter une tâche</span>
                </button>
            </div>
        </section>

        <!-- Notes Section -->
        <section class="notes-section">
            <div class="section-header">
                <h2>
                    <span class="material-symbols-outlined">note</span>
                    <span id="notesTitle">Mes Notes</span>
                </h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn-add" onclick="openAddNoteModal()">
                        <span class="material-symbols-outlined">add</span>
                        <span id="addNoteBtnText">Nouvelle note</span>
                    </button>
                    <button class="section-toggle" onclick="toggleSection('notesContent')" id="notesToggleBtn">Masquer</button>
                </div>
            </div>
            <div id="notesContent" class="section-content">
                <div id="notesContainer" class="notes-grid">
                    <p class="empty-message" id="emptyNotesMessage">Aucune note pour le moment</p>
                </div>
            </div>
        </section>

        <!-- Lists Section -->
        <section class="lists-section">
            <div class="section-header">
                <h2>
                    <span class="material-symbols-outlined">checklist</span>
                    <span id="listsTitle">Mes Listes</span>
                </h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn-add" onclick="openAddListModal()">
                        <span class="material-symbols-outlined">add</span>
                        <span id="addListBtnText">Nouvelle liste</span>
                    </button>
                    <button class="section-toggle" onclick="toggleSection('listsContent')" id="listsToggleBtn">Masquer</button>
                </div>
            </div>
            <div id="listsContent" class="section-content">
                <div id="listsContainer" class="lists-grid">
                    <p class="empty-message" id="emptyListsMessage">Aucune liste pour le moment</p>
                </div>
            </div>
        </section>

        <section class="quick-commands">
            <h3>
                <span class="material-symbols-outlined">bolt</span>
                <span id="commandsTitle">Commandes rapides</span>
                <button class="section-toggle" onclick="toggleSection('commandsContent')" id="commandsToggleBtn">Masquer</button>
            </h3>
            <div id="commandsContent" class="section-content">
            <div class="commands-grid">
                <!-- Tâches -->
                <button class="command-btn" onclick="quickAddTask()">
                    <span class="material-symbols-outlined">add_circle</span>
                    <span>Ajouter une tâche</span>
                </button>
                <button class="command-btn" onclick="quickAddRecursiveTask()">
                    <span class="material-symbols-outlined">add_circle</span>
                    <span>Ajouter une tâche récurrente</span>
                </button>
                <button class="command-btn" onclick="quickAddNote()">
                    <span class="material-symbols-outlined">add_circle</span>
                    <span>Ajouter une note</span>
                </button>
                <button class="command-btn" onclick="quickAddList()">
                    <span class="material-symbols-outlined">add_circle</span>
                    <span>Ajouter une liste</span>
                </button>   


                <button class="command-btn" onclick="quickShowTodayTasks()">
                    <span class="material-symbols-outlined">event</span>
                    <span>Mes tâches aujourd'hui</span>
                </button>
                <button class="command-btn" onclick="quickShowWeekTasks()">
                    <span class="material-symbols-outlined">view_week</span>
                    <span>Tâches de la semaine</span>
                </button>
                <button class="command-btn" onclick="quickShowMonthTasks()">
                    <span class="material-symbols-outlined">calendar_month</span>
                    <span>Tâches du mois</span>
                </button>
                <button class="command-btn" onclick="quickShowYearTasks()">
                    <span class="material-symbols-outlined">calendar_today</span>
                    <span>Tâches de l'année</span>
                </button>
                <button class="command-btn" id="deleteOldTasksBtn" onclick="deleteOldTasks()">
                    <span class="material-symbols-outlined">delete_sweep</span>
                    <span>Supprimer anciennes tâches</span>
                </button>
                <button class="command-btn" id="deleteDoneTasksBtn" onclick="deleteDoneTasks()">
                    <span class="material-symbols-outlined">check_circle</span>
                    <span>Supprimer tâches terminées</span>
                </button>
                <!-- Médicament -->
                <button class="command-btn" onclick="quickAddMedication()">
                    <span class="material-symbols-outlined">medication</span>
                    <span>Ajouter un médicament</span>
                </button>
                <!-- Heure / Date -->
                <button class="command-btn" onclick="quickShowTime()">
                    <span class="material-symbols-outlined">schedule</span>
                    <span>Quelle heure est-il ?</span>
                </button>
                <button class="command-btn" onclick="quickShowDate()">
                    <span class="material-symbols-outlined">calendar_today</span>
                    <span>Quelle est la date ?</span>
                </button>
                <!-- Mode automatique -->
                <button class="command-btn" onclick="quickActivateAutoMode()">
                    <span class="material-symbols-outlined">mic</span>
                    <span>Activer le mode automatique</span>
                </button>
                <button class="command-btn" onclick="quickDeactivateAutoMode()">
                    <span class="material-symbols-outlined">mic_off</span>
                    <span>Désactiver le mode automatique</span>
                </button>
                <!-- Urgence / Contacts -->
                <button class="command-btn" onclick="quickShowEmergencyContacts()">
                    <span class="material-symbols-outlined">local_hospital</span>
                    <span>Contacts d'urgence</span>
                </button>
                <button class="command-btn" onclick="quickConfigureEmergencyContacts()">
                    <span class="material-symbols-outlined">settings</span>
                    <span>Configurer les contacts</span>
                </button>
               
                <!-- Mot de réveil -->
                <button class="command-btn" onclick="quickChangeWakeWord()">
                    <span class="material-symbols-outlined">keyboard_voice</span>
                    <span>Changer le mot de reveil</span>
                </button>
                <!-- Alarmes -->
                <button class="command-btn" onclick="quickSnoozeAlarm()">
                    <span class="material-symbols-outlined">snooze</span>
                    <span>Snooze alarme</span>
                </button>
                <button class="command-btn" onclick="quickDismissAlarm()">
                    <span class="material-symbols-outlined">notifications_off</span>
                    <span>Arrêter l'alarme</span>
                </button>
                <!-- Historique -->
                <button class="command-btn" onclick="clearConversationHistory()">
                    <span class="material-symbols-outlined">delete_sweep</span>
                    <span>Effacer l'historique</span>
                </button>
                <!-- Alarmes supplémentaires -->
                <button class="command-btn" onclick="quickTestAlarm()">
                    <span class="material-symbols-outlined">notifications_active</span>
                    <span>Tester l'alarme</span>
                </button>
                <button class="command-btn" onclick="quickChangeAlarm()">
                    <span class="material-symbols-outlined">alarm</span>
                    <span>Changer l'alarme</span>
                </button>
            </div>
            </div>
        </section>

        <!-- API Key Management Section -->
        <section class="api-management-section">
            <h2>
                <span class="material-symbols-outlined">vpn_key</span>
                <span id="apiKeysTitle">Gestion des clés API</span>
                <button class="section-toggle" onclick="toggleSection('apiKeysContent')" id="apiToggleBtn">Masquer</button>
            </h2>
            
            <div id="apiKeysContent" class="section-content">
                <!-- STT/TTS Provider Selection -->
                <div class="provider-selection">
                    <div class="provider-card">
                        <h3>
                            <span class="material-symbols-outlined">mic</span>
                            <span>Fournisseur STT</span>
                        </h3>
                        <select id="sttProvider" onchange="saveProviderSettings()">
                            <option value="browser" selected>Navigateur (Gratuit)</option>
                            <option value="deepgram">Deepgram API</option>
                            <option value="google">Google Cloud STT</option>
                        </select>
                        <p class="provider-hint">Reconnaissance vocale pour les commandes</p>
                    </div>
                    
                    <div class="provider-card">
                        <h3>
                            <span class="material-symbols-outlined">record_voice_over</span>
                            <span>Fournisseur TTS</span>
                        </h3>
                        <select id="ttsProvider" onchange="updateTTSProviderVoices(); saveProviderSettings();">
                            <option value="browser" selected>Navigateur (Gratuit)</option>
                            <option value="deepgram">Deepgram API</option>
                            <option value="google">Google Cloud TTS</option>
                        </select>
                        <p class="provider-hint">Synthèse vocale pour les réponses</p>
                    </div>
                </div>

                <div class="api-keys-grid">
                    <div class="api-key-card">
                        <h3>Mistral AI <span class="required-badge">Requis</span></h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="mistralApiKey" placeholder="Entrez la clé API Mistral...">
                            <button class="btn-delete" onclick="deleteApiKey('mistral')" title="Supprimer">×</button>
                        </div>
                        <a href="https://console.mistral.ai/" target="_blank" class="api-link">Obtenir une clé API gratuite →</a>
                        <p class="api-description">IA conversationnelle et gestion des tâches</p>
                    </div>
                    
                    <div class="api-key-card">
                        <h3>
                            <span class="material-symbols-outlined">mic</span>
                            Deepgram STT
                        </h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="apiKey_deepgram" placeholder="Entrez la clé API Deepgram...">
                            <button class="btn-delete" onclick="deleteApiKey('deepgram')" title="Supprimer">×</button>
                        </div>
                        <a href="https://console.deepgram.com/" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Reconnaissance vocale (FR/IT/EN)</p>
                    </div>

                    <div class="api-key-card">
                        <h3>
                            <span class="material-symbols-outlined">record_voice_over</span>
                            Deepgram TTS
                        </h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="apiKey_deepgramtts" placeholder="Entrez la clé API Deepgram...">
                            <button class="btn-delete" onclick="deleteApiKey('deepgramtts')" title="Supprimer">×</button>
                        </div>
                        <a href="https://console.deepgram.com/" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Synthèse vocale (FR/IT/EN)</p>
                    </div>
                    
                    <div class="api-key-card">
                        <h3>Google Cloud STT</h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="googleSTTApiKey" placeholder="Entrez la clé API Google STT...">
                            <button class="btn-delete" onclick="deleteApiKey('googleSTT')" title="Supprimer">×</button>
                        </div>
                        <a href="https://cloud.google.com/speech-to-text" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Reconnaissance vocale Google (FR/IT/EN)</p>
                    </div>

                    <div class="api-key-card">
                        <h3>Google Cloud TTS</h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="googleTTSApiKey" placeholder="Entrez la clé API Google TTS...">
                            <button class="btn-delete" onclick="deleteApiKey('googleTTS')" title="Supprimer">×</button>
                        </div>
                        <a href="https://cloud.google.com/text-to-speech" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Synthèse vocale Google (FR/EN)</p>
                    </div>
                    
                    <div class="api-key-card">
                        <h3>
                            <span class="material-symbols-outlined">travel_explore</span>
                            Tavily Search
                        </h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="apiKey_tavily" placeholder="Entrez la clé API Tavily...">
                            <button class="btn-delete" onclick="deleteApiKey('tavily')" title="Supprimer">×</button>
                        </div>
                        <a href="https://tavily.com/" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Recherche web intelligente</p>
                    </div>
                    
                    <div class="api-key-card">
                        <h3>
                            <span class="material-symbols-outlined">partly_cloudy_day</span>
                            OpenWeatherMap
                        </h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="apiKey_openweathermap" placeholder="Entrez la clé API OpenWeatherMap...">
                            <button class="btn-delete" onclick="deleteApiKey('openweathermap')" title="Supprimer">×</button>
                        </div>
                        <a href="https://openweathermap.org/api" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Données météo actuelles et prévisions (optionnel)</p>
                    </div>
                    
                    <div class="api-key-card">
                        <h3>
                            <span class="material-symbols-outlined">cloud</span>
                            WeatherAPI.com
                        </h3>
                        <div class="api-input-wrapper">
                            <input type="password" id="apiKey_weatherapi" placeholder="Entrez la clé API WeatherAPI...">
                            <button class="btn-delete" onclick="deleteApiKey('weatherapi')" title="Supprimer">×</button>
                        </div>
                        <a href="https://www.weatherapi.com/" target="_blank" class="api-link">Obtenir une clé API →</a>
                        <p class="api-description">Prévisions météo détaillées (optionnel)</p>
                    </div>
                    
                    <div class="api-key-card no-key-required">
                        <h3>
                            <span class="material-symbols-outlined">wb_sunny</span>
                            Open-Meteo
                        </h3>
                        <div class="no-key-notice">
                            <span>✓ Pas de clé API requise</span>
                        </div>
                        <a href="https://open-meteo.com/" target="_blank" class="api-link">En savoir plus →</a>
                        <p class="api-description">Service météo gratuit sans inscription</p>
                    </div>
                </div>

                <div class="api-actions">
                    <label class="remember-key-label">
                        <input type="checkbox" id="rememberKeys" checked>
                        <span id="rememberKeysText">Mémoriser les clés API</span>
                    </label>
                    <button class="btn-save" onclick="saveApiKeys()" id="saveKeysBtn">Enregistrer les clés</button>
                </div>
            </div>
        </section>

        <!-- Activity Tracking Settings -->
        <section class="activity-settings-section">
            <h2>
                <span class="material-symbols-outlined">directions_run</span>
                <span id="activitySettingsTitle">Suivi d'activité</span>
                <button class="section-toggle" onclick="toggleSection('activitySettingsContent')" id="activitySettingsToggleBtn">Afficher</button>
            </h2>
            
            <div id="activitySettingsContent" class="section-content" style="display: none;">
                <div class="setting-card">
                    <div class="setting-header">
                        <label for="enableActivityTracking">
                            <span class="material-symbols-outlined">track_changes</span>
                            <span id="enableTrackingLabel">Activer le suivi automatique</span>
                        </label>
                        <label class="switch">
                            <input type="checkbox" id="enableActivityTracking" onchange="toggleActivityTracking()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <p class="setting-description">
                        Le suivi enregistre automatiquement vos déplacements (pas, distance, GPS) en arrière-plan.
                        Vous pouvez consulter vos statistiques et parcours à tout moment.
                    </p>
                </div>

                <div class="setting-card">
                    <label for="dailyStepsGoal">
                        <span class="material-symbols-outlined">flag</span>
                        <span id="stepsGoalLabel">Objectif de pas quotidien</span>
                    </label>
                    <input type="number" id="dailyStepsGoal" min="1000" max="50000" step="1000" value="10000" onchange="saveDailyStepsGoal()">
                    <p class="setting-description">Nombre de pas à atteindre chaque jour</p>
                </div>

                <div class="tracking-status" id="trackingStatus" style="display: none;">
                    <div class="status-indicator">
                        <span class="status-dot active"></span>
                        <span id="trackingStatusText">Suivi actif</span>
                    </div>
                    <div class="tracking-info">
                        <p id="trackingDuration">Durée: --</p>
                        <p id="trackingSteps">Pas: --</p>
                        <p id="trackingDistance">Distance: --</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mistral Conversation Settings -->
        <section class="mistral-settings-section">
            <h2>
                <span class="material-symbols-outlined">smart_toy</span>
                <span id="mistralSettingsTitle">Paramètres de conversation Mistral</span>
                <button class="section-toggle" onclick="toggleSection('mistralSettingsContent')" id="mistralToggleBtn">Afficher</button>
            </h2>
            
            <div id="mistralSettingsContent" class="section-content" style="display: none;">
                <div class="mistral-settings-grid">
                    <div class="setting-card full-width">
                        <label for="systemPrompt">
                            <span class="material-symbols-outlined">description</span>
                            <span id="systemPromptLabel">Prompt système</span>
                        </label>
                        <textarea id="systemPrompt" rows="6"></textarea>
                        <p class="setting-hint" id="systemPromptHint">Définit le comportement et le style de réponse de l'IA</p>
                    </div>

                    <div class="setting-card">
                        <label for="mistralModel">
                            <span class="material-symbols-outlined">model_training</span>
                            <span id="modelLabel">Modèle</span>
                        </label>
                        <select id="mistralModel">
                            <option value="mistral-small-latest" selected>Mistral Small (Rapide)</option>
                            <option value="mistral-medium-latest">Mistral Medium (Équilibré)</option>
                            <option value="mistral-large-latest">Mistral Large (Puissant)</option>
                            <option value="open-mistral-7b">Open Mistral 7B</option>
                            <option value="open-mixtral-8x7b">Open Mixtral 8x7B</option>
                            <option value="open-mixtral-8x22b">Open Mixtral 8x22B</option>
                        </select>
                        <p class="setting-hint" id="modelHint">Choisissez le modèle selon vos besoins de performance/qualité</p>
                    </div>

                    <div class="setting-card">
                        <label for="mistralTemperature">
                            <span class="material-symbols-outlined">thermostat</span>
                            <span id="temperatureLabel">Température</span>
                            <span class="setting-value" id="temperatureValue">0.3</span>
                        </label>
                        <input type="range" id="mistralTemperature" min="0" max="1" step="0.1" value="0.3" oninput="updateMistralValue('temperature', this.value)" />
                        <div class="range-labels">
                            <span>0 (Précis)</span>
                            <span>0.5</span>
                            <span>1 (Créatif)</span>
                        </div>
                        <p class="setting-hint" id="temperatureHint">Contrôle la créativité des réponses (0 = déterministe, 1 = créatif)</p>
                    </div>

                    <div class="setting-card">
                        <label for="mistralMaxTokens">
                            <span class="material-symbols-outlined">text_fields</span>
                            <span id="maxTokensLabel">Tokens maximum</span>
                            <span class="setting-value" id="maxTokensValue">500</span>
                        </label>
                        <input type="range" id="mistralMaxTokens" min="100" max="4000" step="100" value="500" oninput="updateMistralValue('maxTokens', this.value)" />
                        <div class="range-labels">
                            <span>100</span>
                            <span>2000</span>
                            <span>4000</span>
                        </div>
                        <p class="setting-hint" id="maxTokensHint">Longueur maximale de la réponse générée</p>
                    </div>

                    <div class="setting-card">
                        <label for="mistralTopP">
                            <span class="material-symbols-outlined">filter_alt</span>
                            <span id="topPLabel">Top P (nucleus sampling)</span>
                            <span class="setting-value" id="topPValue">0.9</span>
                        </label>
                        <input type="range" id="mistralTopP" min="0" max="1" step="0.05" value="0.9" oninput="updateMistralValue('topP', this.value)" />
                        <div class="range-labels">
                            <span>0</span>
                            <span>0.5</span>
                            <span>1</span>
                        </div>
                        <p class="setting-hint" id="topPHint">Contrôle la diversité en filtrant les tokens peu probables</p>
                    </div>

                    <div class="setting-card">
                        <label>
                            <span class="material-symbols-outlined">settings_suggest</span>
                            <span id="advancedOptionsLabel">Options avancées</span>
                        </label>
                        <label class="setting-checkbox-label">
                            <input type="checkbox" id="mistralSafeMode" />
                            <span id="safeModeLabel">Mode sécurisé (Safe Mode)</span>
                        </label>
                        <label class="setting-checkbox-label">
                            <input type="checkbox" id="mistralRandomSeed" />
                            <span id="useRandomSeedLabel">Utiliser une graine aléatoire (reproductibilité)</span>
                        </label>
                        <p class="setting-hint" id="advancedHint">Options de sécurité et de reproductibilité</p>
                    </div>
                </div>

                <div class="mistral-actions">
                    <button class="btn-reset" onclick="resetMistralSettings()">
                        <span class="material-symbols-outlined">restart_alt</span>
                        <span id="resetToDefaultBtn">Réinitialiser par défaut</span>
                    </button>
                    <button class="btn-save" onclick="saveMistralSettings()">
                        <span class="material-symbols-outlined">save</span>
                        <span id="saveSettingsBtn">Enregistrer les paramètres</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Wake Word Configuration Section -->
        <section class="wake-word-section">
            <h2>
                <span class="material-symbols-outlined">keyboard_voice</span>
                <span id="wakeWordTitle">Mot de Réveil</span>
                <button class="section-toggle" onclick="toggleSection('wakeWordContent')" id="wakeWordToggleBtn">Afficher</button>
            </h2>
            <div class="wake-word-content section-content" id="wakeWordContent" style="display: none;">
                <div class="wake-word-info">
                    <p id="wakeWordDescription">
                        Le mot de réveil permet d'activer l'assistant sans redemander l'autorisation du micro. 
                        Dites d'abord le mot de réveil, puis votre commande.
                    </p>
                    <div class="wake-word-status" id="wakeWordStatus">
                        Mot de réveil actif: "assistant"
                    </div>
                </div>
                <div class="input-group">
                    <label for="wakeWord">
                        <span class="material-symbols-outlined">keyboard_voice</span>
                        <span id="wakeWordLabel">Mot de réveil:</span>
                    </label>
                    <input type="text" id="wakeWord" value="assistant" placeholder="Ex: assistant, ok computer, hey aide...">
                    <span class="hint" id="wakeWordHint">Choisissez un mot ou une courte phrase facile à prononcer</span>
                </div>
                <div class="wake-word-actions">
                    <label class="remember-key-label">
                        <input type="checkbox" id="wakeWordEnabled" checked>
                        <span id="wakeWordEnabledText">Activer le mot de réveil</span>
                    </label>
                    <button class="btn-save" onclick="saveWakeWordSettings()" id="saveWakeWordBtn">
                        <span class="material-symbols-outlined">save</span>
                        <span>Enregistrer</span>
                    </button>
                </div>
                <div class="wake-word-examples">
                    <h4 id="examplesTitle">Exemples d'utilisation:</h4>
                    <ul>
                        <li id="example1">"<strong>assistant</strong>, quelle heure est-il ?"</li>
                        <li id="example2">"<strong>assistant</strong>, ajoute une tâche pour demain"</li>
                        <li id="example3">"<strong>assistant</strong>, qu'ai-je aujourd'hui ?"</li>
                    </ul>
                </div>
            </div>
        </section>
                <!-- Text-to-Speech Configuration -->
        <section class="tts-section">
            <h2>
                <span class="material-symbols-outlined">speaker</span>
                <span id="ttsSettingsTitle">Paramètres de synthèse vocale</span>
                <button class="section-toggle" onclick="toggleSection('ttsContent')" id="ttsToggleBtn">
                    <span id="ttsShowBtn">Afficher</span>
                </button>
            </h2>
            <div id="ttsContent" class="section-content" style="display: none;">
                <div class="tts-grid">
                    <div class="tts-card">
                        <label for="ttsVoice">
                            <span class="material-symbols-outlined">voice_selection</span>
                            <span id="selectVoiceLabel">Sélectionner une voix</span>
                        </label>
                        <select id="ttsVoice" onchange="updateTTSVoice(this.value)">
                            <optgroup label="Navigateur - Browser" data-provider="browser">
                                <option value="browser-default" data-provider="browser" selected>Voix par défaut / Default Voice</option>
                            </optgroup>
                            <optgroup label="Deepgram - Français" data-provider="deepgram">
                                <option value="aura-2-agathe-fr" data-provider="deepgram">Agathe (Femme)</option>
                                <option value="aura-2-hector-fr" data-provider="deepgram">Hector (Homme)</option>
                            </optgroup>
                            <optgroup label="Deepgram - English" data-provider="deepgram">
                                <option value="aura-2-thalia-en" data-provider="deepgram">Thalia (Female)</option>
                                <option value="aura-2-andromeda-en" data-provider="deepgram">Andromeda (Female)</option>
                                <option value="aura-2-helena-en" data-provider="deepgram">Helena (Female)</option>
                                <option value="aura-2-athena-en" data-provider="deepgram">Athena (Female)</option>
                                <option value="aura-2-hera-en" data-provider="deepgram">Hera (Female)</option>
                                <option value="aura-2-luna-en" data-provider="deepgram">Luna (Female)</option>
                                <option value="aura-2-apollo-en" data-provider="deepgram">Apollo (Male)</option>
                                <option value="aura-2-arcas-en" data-provider="deepgram">Arcas (Male)</option>
                                <option value="aura-2-orion-en" data-provider="deepgram">Orion (Male)</option>
                                <option value="aura-2-orpheus-en" data-provider="deepgram">Orpheus (Male)</option>
                            </optgroup>
                            <optgroup label="Deepgram - Italiano" data-provider="deepgram">
                                <option value="aura-2-livia-it" data-provider="deepgram">Livia (Femmina)</option>
                                <option value="aura-2-melia-it" data-provider="deepgram">Melia (Femmina)</option>
                                <option value="aura-2-maia-it" data-provider="deepgram">Maia (Femmina)</option>
                                <option value="aura-2-cinzia-it" data-provider="deepgram">Cinzia (Femmina)</option>
                                <option value="aura-2-dionisio-it" data-provider="deepgram">Dionisio (Maschio)</option>
                                <option value="aura-2-elio-it" data-provider="deepgram">Elio (Maschio)</option>
                                <option value="aura-2-flavio-it" data-provider="deepgram">Flavio (Maschio)</option>
                                <option value="aura-2-cesare-it" data-provider="deepgram">Cesare (Maschio)</option>
                            </optgroup>
                            <optgroup label="Google - Français (French) - Neural2" data-provider="google">
                                <option value="fr-FR-Neural2-A" data-provider="google" data-gender="female">Neural2-A (Femme)</option>
                                <option value="fr-FR-Neural2-B" data-provider="google" data-gender="male">Neural2-B (Homme)</option>
                                <option value="fr-FR-Neural2-C" data-provider="google" data-gender="female">Neural2-C (Femme)</option>
                                <option value="fr-FR-Neural2-D" data-provider="google" data-gender="male">Neural2-D (Homme)</option>
                                <option value="fr-FR-Neural2-E" data-provider="google" data-gender="female">Neural2-E (Femme)</option>
                            </optgroup>
                            <optgroup label="Google - Français (French) - Wavenet" data-provider="google">
                                <option value="fr-FR-Neural2-A" data-gender="female" selected>Neural2-A (Femme)</option>
                                <option value="fr-FR-Neural2-B" data-gender="male">Neural2-B (Homme)</option>
                                <option value="fr-FR-Neural2-C" data-gender="female">Neural2-C (Femme)</option>
                                <option value="fr-FR-Neural2-D" data-gender="male">Neural2-D (Homme)</option>
                                <option value="fr-FR-Neural2-E" data-gender="female">Neural2-E (Femme)</option>
                            </optgroup>
                            <optgroup label="Français (French) - Wavenet">
                                <option value="fr-FR-Wavenet-A" data-gender="female">Wavenet-A (Femme)</option>
                                <option value="fr-FR-Wavenet-B" data-gender="male">Wavenet-B (Homme)</option>
                                <option value="fr-FR-Wavenet-C" data-gender="female">Wavenet-C (Femme)</option>
                                <option value="fr-FR-Wavenet-D" data-gender="male">Wavenet-D (Homme)</option>
                                <option value="fr-FR-Wavenet-E" data-gender="female">Wavenet-E (Femme)</option>
                            </optgroup>
                            <optgroup label="Français (French) - Standard">
                                <option value="fr-FR-Standard-A" data-gender="female">Standard-A (Femme)</option>
                                <option value="fr-FR-Standard-B" data-gender="male">Standard-B (Homme)</option>
                                <option value="fr-FR-Standard-C" data-gender="female">Standard-C (Femme)</option>
                                <option value="fr-FR-Standard-D" data-gender="male">Standard-D (Homme)</option>
                                <option value="fr-FR-Standard-E" data-gender="female">Standard-E (Femme)</option>
                            </optgroup>
                            <optgroup label="Italien (Italian) - Neural2">
                                <option value="it-IT-Neural2-A" data-gender="female">Neural2-A (Femme)</option>
                                <option value="it-IT-Neural2-C" data-gender="male">Neural2-C (Homme)</option>
                            </optgroup>
                            <optgroup label="Italien (Italian) - Wavenet">
                                <option value="it-IT-Wavenet-A" data-gender="female">Wavenet-A (Femme)</option>
                                <option value="it-IT-Wavenet-B" data-gender="female">Wavenet-B (Femme)</option>
                                <option value="it-IT-Wavenet-C" data-gender="male">Wavenet-C (Homme)</option>
                                <option value="it-IT-Wavenet-D" data-gender="male">Wavenet-D (Homme)</option>
                            </optgroup>
                            <optgroup label="Italien (Italian) - Standard">
                                <option value="it-IT-Standard-A" data-gender="female">Standard-A (Femme)</option>
                                <option value="it-IT-Standard-B" data-gender="female">Standard-B (Femme)</option>
                                <option value="it-IT-Standard-C" data-gender="male">Standard-C (Homme)</option>
                                <option value="it-IT-Standard-D" data-gender="male">Standard-D (Homme)</option>
                            </optgroup>
                            <optgroup label="Anglais US - Neural2">
                                <option value="en-US-Neural2-A" data-gender="male">Neural2-A (Male)</option>
                                <option value="en-US-Neural2-C" data-gender="female">Neural2-C (Female)</option>
                                <option value="en-US-Neural2-D" data-gender="male">Neural2-D (Male)</option>
                                <option value="en-US-Neural2-E" data-gender="female">Neural2-E (Female)</option>
                                <option value="en-US-Neural2-F" data-gender="female">Neural2-F (Female)</option>
                                <option value="en-US-Neural2-G" data-gender="female">Neural2-G (Female)</option>
                                <option value="en-US-Neural2-H" data-gender="female">Neural2-H (Female)</option>
                                <option value="en-US-Neural2-I" data-gender="male">Neural2-I (Male)</option>
                                <option value="en-US-Neural2-J" data-gender="male">Neural2-J (Male)</option>
                            </optgroup>
                            <optgroup label="Anglais US - Wavenet">
                                <option value="en-US-Wavenet-A" data-gender="male">Wavenet-A (Male)</option>
                                <option value="en-US-Wavenet-B" data-gender="male">Wavenet-B (Male)</option>
                                <option value="en-US-Wavenet-C" data-gender="female">Wavenet-C (Female)</option>
                                <option value="en-US-Wavenet-D" data-gender="male">Wavenet-D (Male)</option>
                                <option value="en-US-Wavenet-E" data-gender="female">Wavenet-E (Female)</option>
                                <option value="en-US-Wavenet-F" data-gender="female">Wavenet-F (Female)</option>
                                <option value="en-US-Wavenet-G" data-gender="female">Wavenet-G (Female)</option>
                                <option value="en-US-Wavenet-H" data-gender="female">Wavenet-H (Female)</option>
                                <option value="en-US-Wavenet-I" data-gender="male">Wavenet-I (Male)</option>
                                <option value="en-US-Wavenet-J" data-gender="male">Wavenet-J (Male)</option>
                            </optgroup>
                            <optgroup label="Anglais US - Standard">
                                <option value="en-US-Standard-A" data-gender="male">Standard-A (Male)</option>
                                <option value="en-US-Standard-B" data-gender="male">Standard-B (Male)</option>
                                <option value="en-US-Standard-C" data-gender="female">Standard-C (Female)</option>
                                <option value="en-US-Standard-D" data-gender="male">Standard-D (Male)</option>
                                <option value="en-US-Standard-E" data-gender="female">Standard-E (Female)</option>
                                <option value="en-US-Standard-F" data-gender="female">Standard-F (Female)</option>
                                <option value="en-US-Standard-G" data-gender="female">Standard-G (Female)</option>
                                <option value="en-US-Standard-H" data-gender="female">Standard-H (Female)</option>
                                <option value="en-US-Standard-I" data-gender="male">Standard-I (Male)</option>
                                <option value="en-US-Standard-J" data-gender="male">Standard-J (Male)</option>
                            </optgroup>
                        </select>
                        <p class="tts-hint" id="voiceHint">Choisissez la voix pour la lecture des annonces</p>
                    </div>
                    <div class="tts-card">
                        <label for="ttsSpeakingRate">
                            <span class="material-symbols-outlined">speed</span>
                            <span id="speakingRateLabel">Vitesse de lecture</span>
                            <span class="tts-value" id="speakingRateValue">0.9x</span>
                        </label>
                        <input type="range" id="ttsSpeakingRate" min="0.5" max="2.0" step="0.1" value="0.9" oninput="updateTTSValue('speakingRate', this.value)" />
                        <div class="range-labels">
                            <span>0.5x</span>
                            <span>1.0x</span>
                            <span>2.0x</span>
                        </div>
                        <p class="tts-hint" id="speakingRateHint">Contrôle la rapidité de la voix</p>
                    </div>
                    <div class="tts-card">
                        <label for="ttsPitch">
                            <span class="material-symbols-outlined">graphic_eq</span>
                            <span id="pitchLabel">Tonalité (Pitch)</span>
                            <span class="tts-value" id="pitchValue">0</span>
                        </label>
                        <input type="range" id="ttsPitch" min="-20" max="20" step="1" value="0" oninput="updateTTSValue('pitch', this.value)" />
                        <div class="range-labels">
                            <span>-20</span>
                            <span>0</span>
                            <span>+20</span>
                        </div>
                        <p class="tts-hint" id="pitchHint">Ajuste la hauteur de la voix</p>
                    </div>
                    <div class="tts-card">
                        <label for="ttsVolume">
                            <span class="material-symbols-outlined">volume_up</span>
                            <span id="volumeLabel">Volume</span>
                            <span class="tts-value" id="volumeValue">2 dB</span>
                        </label>
                        <input type="range" id="ttsVolume" min="-16" max="16" step="1" value="2" oninput="updateTTSValue('volume', this.value)" />
                        <div class="range-labels">
                            <span>-16 dB</span>
                            <span>0 dB</span>
                            <span>+16 dB</span>
                        </div>
                        <p class="tts-hint" id="volumeHint">Ajuste le niveau sonore</p>
                    </div>
                </div>

                <!-- SSML Configuration -->
                <div class="ssml-section">
                    <h3>
                        <span class="material-symbols-outlined">psychology</span>
                        <span id="ssmlTitle">Paramètres d'expressivité (SSML)</span>
                    </h3>
                    <div class="tts-grid">
                        <div class="tts-card full-width">
                            <label class="setting-checkbox-label">
                                <input type="checkbox" id="ssmlEnabled" checked onchange="updateSSMLSettings()">
                                <span id="ssmlEnabledLabel">Activer l'expressivité vocale (SSML)</span>
                            </label>
                            <p class="tts-hint" id="ssmlHint">Ajoute automatiquement des emphases, pauses et intonations pour une voix plus naturelle</p>
                        </div>

                        <div class="tts-card" id="ssmlPausesCard">
                            <label for="ssmlSentencePause">
                                <span class="material-symbols-outlined">pause</span>
                                <span id="sentencePauseLabel">Pause entre phrases</span>
                                <span class="tts-value" id="sentencePauseValue">500 ms</span>
                            </label>
                            <input type="range" id="ssmlSentencePause" min="200" max="1000" step="50" value="500" oninput="updateSSMLValue('sentencePause', this.value)" />
                            <div class="range-labels">
                                <span>200ms</span>
                                <span>500ms</span>
                                <span>1000ms</span>
                            </div>
                            <p class="tts-hint" id="sentencePauseHint">Durée des pauses entre les phrases</p>
                        </div>

                        <div class="tts-card" id="ssmlTimePauseCard">
                            <label for="ssmlTimePause">
                                <span class="material-symbols-outlined">schedule</span>
                                <span id="timePauseLabel">Pause avant heures/dates</span>
                                <span class="tts-value" id="timePauseValue">200 ms</span>
                            </label>
                            <input type="range" id="ssmlTimePause" min="0" max="500" step="50" value="200" oninput="updateSSMLValue('timePause', this.value)" />
                            <div class="range-labels">
                                <span>0ms</span>
                                <span>250ms</span>
                                <span>500ms</span>
                            </div>
                            <p class="tts-hint" id="timePauseHint">Pause avant les heures et dates</p>
                        </div>

                        <div class="tts-card" id="ssmlEmphasisCard">
                            <label for="ssmlEmphasisLevel">
                                <span class="material-symbols-outlined">format_bold</span>
                                <span id="emphasisLevelLabel">Niveau d'emphase</span>
                            </label>
                            <select id="ssmlEmphasisLevel" onchange="updateSSMLSettings()">
                                <option value="moderate">Modéré</option>
                                <option value="strong" selected>Fort (Recommandé)</option>
                                <option value="reduced">Réduit</option>
                            </select>
                            <p class="tts-hint" id="emphasisHint">Intensité des emphases sur les mots-clés</p>
                        </div>

                        <div class="tts-card full-width" id="ssmlCustomKeywordsCard">
                            <label for="ssmlCustomKeywords">
                                <span class="material-symbols-outlined">text_fields</span>
                                <span id="customKeywordsLabel">Mots-clés personnalisés</span>
                            </label>
                            <input type="text" id="ssmlCustomKeywords" placeholder="Ex: prénom, médicament spécifique, lieu..." onchange="updateSSMLSettings()">
                            <p class="tts-hint" id="customKeywordsHint">Ajoutez des mots séparés par des virgules qui seront prononcés avec emphase forte (en plus des mots-clés par défaut)</p>
                        </div>

                        <div class="tts-card" id="ssmlKeywordPitchCard">
                            <label for="ssmlKeywordPitch">
                                <span class="material-symbols-outlined">trending_up</span>
                                <span id="keywordPitchLabel">Élévation des mots-clés</span>
                                <span class="tts-value" id="keywordPitchValue">+1 st</span>
                            </label>
                            <input type="range" id="ssmlKeywordPitch" min="-5" max="5" step="1" value="1" oninput="updateSSMLValue('keywordPitch', this.value)" />
                            <div class="range-labels">
                                <span>-5 st</span>
                                <span>0 st</span>
                                <span>+5 st</span>
                            </div>
                            <p class="tts-hint" id="keywordPitchHint">Élévation du ton pour les mots-clés importants (semitones)</p>
                        </div>

                        <div class="tts-card" id="ssmlQuestionPitchCard">
                            <label for="ssmlQuestionPitch">
                                <span class="material-symbols-outlined">help</span>
                                <span id="questionPitchLabel">Intonation des questions</span>
                                <span class="tts-value" id="questionPitchValue">+2 st</span>
                            </label>
                            <input type="range" id="ssmlQuestionPitch" min="0" max="5" step="1" value="2" oninput="updateSSMLValue('questionPitch', this.value)" />
                            <div class="range-labels">
                                <span>0 st</span>
                                <span>+2 st</span>
                                <span>+5 st</span>
                            </div>
                            <p class="tts-hint" id="questionPitchHint">Élévation du ton pour les questions (semitones)</p>
                        </div>

                        <div class="tts-card" id="ssmlExclamationCard">
                            <label for="ssmlExclamationPitch">
                                <span class="material-symbols-outlined">priority_high</span>
                                <span id="exclamationPitchLabel">Énergie des exclamations</span>
                                <span class="tts-value" id="exclamationPitchValue">+1 st</span>
                            </label>
                            <input type="range" id="ssmlExclamationPitch" min="0" max="3" step="1" value="1" oninput="updateSSMLValue('exclamationPitch', this.value)" />
                            <div class="range-labels">
                                <span>0 st</span>
                                <span>+1 st</span>
                                <span>+3 st</span>
                            </div>
                            <p class="tts-hint" id="exclamationPitchHint">Variation du ton pour les exclamations</p>
                        </div>

                        <div class="tts-card" id="ssmlGreetingCard">
                            <label for="ssmlGreetingPitch">
                                <span class="material-symbols-outlined">waving_hand</span>
                                <span id="greetingPitchLabel">Chaleur des salutations</span>
                                <span class="tts-value" id="greetingPitchValue">+1 st</span>
                            </label>
                            <input type="range" id="ssmlGreetingPitch" min="0" max="3" step="1" value="1" oninput="updateSSMLValue('greetingPitch', this.value)" />
                            <div class="range-labels">
                                <span>0 st</span>
                                <span>+1 st</span>
                                <span>+3 st</span>
                            </div>
                            <p class="tts-hint" id="greetingPitchHint">Ton plus chaleureux pour "Bonjour", "Hello", etc.</p>
                        </div>
                    </div>

                    <div class="ssml-actions">
                        <button class="btn-reset" onclick="resetSSMLSettings()">
                            <span class="material-symbols-outlined">restart_alt</span>
                            <span id="resetSSMLBtn">Réinitialiser SSML</span>
                        </button>
                        <button class="btn-save" onclick="saveSSMLSettings()">
                            <span class="material-symbols-outlined">save</span>
                            <span id="saveSSMLBtn">Enregistrer SSML</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="addTaskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addTaskModalTitle">Ajouter une tâche</h2>
                <button class="close-btn" onclick="closeAddTaskModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="taskDescription" id="taskDescLabel">Description de la tâche:</label>
                    <textarea id="taskDescription" rows="3" placeholder="Exemple: Prendre mes médicaments"></textarea>
                </div>
                <div class="input-group">
                    <label for="taskDate" id="taskDateLabel">Date:</label>
                    <input type="date" id="taskDate">
                </div>
                <div class="input-group">
                    <label for="taskTime" id="taskTimeLabel">Heure:</label>
                    <input type="time" id="taskTime">
                </div>
                <div class="input-group">
                    <label for="taskType" id="taskTypeLabel">Type:</label>
                    <select id="taskType">
                        <option value="general">Général</option>
                        <option value="medication">Médicament</option>
                        <option value="appointment">Rendez-vous</option>
                        <option value="call">Appel téléphonique</option>
                        <option value="shopping">Courses</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="taskPriority" id="taskPriorityLabel">Priorité:</label>
                    <select id="taskPriority">
                        <option value="normal">Normal</option>
                        <option value="urgent">Urgent</option>
                        <option value="low">Faible</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="taskRecurrence" id="taskRecurrenceLabel">Récurrence:</label>
                    <select id="taskRecurrence">
                        <option value="">Aucune (Ponctuelle)</option>
                        <option value="daily">Quotidienne</option>
                        <option value="weekly">Hebdomadaire</option>
                        <option value="monthly">Mensuelle</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAddTaskModal()" id="cancelTaskBtn">Annuler</button>
                <button class="btn-primary" onclick="saveNewTask()" id="saveTaskBtn">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Add Note Modal -->
    <div id="addNoteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addNoteModalTitle">Ajouter une note</h2>
                <button class="close-btn" onclick="closeAddNoteModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="noteTitle" id="noteTitleLabel">Titre:</label>
                    <input type="text" id="noteTitle" placeholder="Titre de la note">
                </div>
                <div class="input-group">
                    <label for="noteContent" id="noteContentLabel">Contenu:</label>
                    <textarea id="noteContent" rows="8" placeholder="Écrivez votre note ici..."></textarea>
                </div>
                <div class="input-group">
                    <label for="noteCategory" id="noteCategoryLabel">Catégorie:</label>
                    <select id="noteCategory">
                        <option value="general">Général</option>
                        <option value="personal">Personnel</option>
                        <option value="work">Travail</option>
                        <option value="ideas">Idées</option>
                        <option value="reminder">Rappel</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="noteColor" id="noteColorLabel">Couleur:</label>
                    <div class="color-picker">
                        <button class="color-option" data-color="#2a2a2a" style="background: #2a2a2a;" onclick="selectNoteColor('#2a2a2a')"></button>
                        <button class="color-option" data-color="#1a3a4a" style="background: #1a3a4a;" onclick="selectNoteColor('#1a3a4a')"></button>
                        <button class="color-option" data-color="#3a2a1a" style="background: #3a2a1a;" onclick="selectNoteColor('#3a2a1a')"></button>
                        <button class="color-option" data-color="#2a1a3a" style="background: #2a1a3a;" onclick="selectNoteColor('#2a1a3a')"></button>
                        <button class="color-option" data-color="#1a3a2a" style="background: #1a3a2a;" onclick="selectNoteColor('#1a3a2a')"></button>
                        <button class="color-option" data-color="#3a1a1a" style="background: #3a1a1a;" onclick="selectNoteColor('#3a1a1a')"></button>
                    </div>
                </div>
                <div class="input-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="notePinned">
                        <span id="notePinnedLabel">Épingler cette note</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAddNoteModal()" id="cancelNoteBtn">Annuler</button>
                <button class="btn-primary" onclick="saveNewNote()" id="saveNoteBtn">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Add List Modal -->
    <div id="addListModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addListModalTitle">Ajouter une liste</h2>
                <button class="close-btn" onclick="closeAddListModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="listTitle" id="listTitleLabel">Titre:</label>
                    <input type="text" id="listTitle" placeholder="Titre de la liste">
                </div>
                <div class="input-group">
                    <label for="listCategory" id="listCategoryLabel">Catégorie:</label>
                    <select id="listCategory">
                        <option value="general">Général</option>
                        <option value="shopping">Courses</option>
                        <option value="todo">À faire</option>
                        <option value="ideas">Idées</option>
                        <option value="goals">Objectifs</option>
                    </select>
                </div>
                <div class="input-group">
                    <label id="listItemsLabel">Éléments de la liste:</label>
                    <div id="listItemsContainer">
                        <div class="list-item-input">
                            <input type="text" placeholder="Élément 1" class="list-item-field">
                            <button class="btn-remove-item" onclick="removeListItem(this)" style="display: none;">×</button>
                        </div>
                    </div>
                    <button class="btn-add-item" onclick="addListItem()">
                        <span class="material-symbols-outlined">add</span>
                        <span id="addItemBtnText">Ajouter un élément</span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAddListModal()" id="cancelListBtn">Annuler</button>
                <button class="btn-primary" onclick="saveNewList()" id="saveListBtn">Enregistrer</button>
            </div>
        </div>
    </div>

    <div id="alarmNotification" class="alarm-notification" style="display: none;">
        <div class="alarm-content">
            <div class="alarm-icon">
                <span class="material-symbols-outlined">notifications_active</span>
            </div>
            <div class="alarm-info">
                <h3 id="alarmTitle">Rappel !</h3>
                <p id="alarmMessage">Il est temps de...</p>
            </div>
            <div class="alarm-actions">
                <button class="btn-snooze" onclick="snoozeAlarm()" id="snoozeBtn">
                    <span class="material-symbols-outlined">snooze</span>
                    <span id="snoozeBtnText">10 min</span>
                </button>
                <button class="btn-done" onclick="dismissAlarm()" id="doneBtn">
                    <span class="material-symbols-outlined">check_circle</span>
                    <span id="doneBtnText">Fait</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Floating Voice Button -->
    <button class="btn-voice-floating" id="floatingVoiceBtn" style="display: none;" onclick="handleVoiceInteraction()">
        <span class="material-symbols-outlined">mic</span>
    </button>

    <footer class="footer">
        <p>Arnaud Cassone © Artcraft Visuals 2025</p>
        <a href="https://www.artcraft-zone.com" target="_blank">www.artcraft-zone.com</a>
    </footer>


    <div id="taskPopup" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="taskPopupTitle">Détail de la tâche</h2>
                <button class="close-btn" onclick="closeTaskPopup()">×</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="taskPopupDesc">Description:</label>
                    <div id="taskPopupDesc"></div>
                </div>
                <div class="input-group">
                    <label for="taskPopupDate">Date:</label>
                    <div id="taskPopupDate"></div>
                </div>
                <div class="input-group">
                    <label for="taskPopupTime">Heure:</label>
                    <div id="taskPopupTime"></div>
                </div>
                <div class="input-group">
                    <label for="taskPopupType">Type:</label>
                    <span class="material-symbols-outlined" id="taskPopupTypeIcon">today</span>
                    <span id="taskPopupType"></span>
                    <div id="taskPopupTypeValue" style="margin-top:5px;"></div>
                </div>
                <div class="input-group">
                    <label for="taskPopupPriority">Priorité:</label>
                    <div id="taskPopupPriority"></div>
                </div>
                <div class="input-group">
                    <label for="taskPopupRecurrence">Récurrence:</label>
                    <div id="taskPopupRecurrence"></div>
                </div>
                <div class="input-group">
                    <label for="taskPopupStatus">Statut:</label>
                    <div id="taskPopupStatus"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="popupEditBtn" onclick="editTaskPopup()">
                    <span class="material-symbols-outlined">edit</span> Modifier
                </button>
                <button class="btn-primary" id="popupDoneBtn" onclick="markTaskDone()">
                    <span class="material-symbols-outlined">check_circle</span> Fait
                </button>
                <button class="btn-secondary" id="popupDeleteBtn" onclick="deleteTaskPopup()">
                    <span class="material-symbols-outlined">delete</span> Supprimer
                </button>
            </div>
        </div>
    </div>

    <!-- Alarm Sound (for alarm-system.js) -->
    <audio id="alarmSound" loop>
        <source src="assets/alarm-sounds/gentle-alarm.mp3" type="audio/mpeg">
    </audio>

    <!-- Undo Button (floating) -->
    <button id="undoButton" class="undo-button" onclick="handleUndoClick()" style="display: none;">
        <span class="material-symbols-outlined">undo</span>
        <span class="undo-text">Annuler</span>
    </button>

    <!-- Undo Toast Notification -->
    <div id="undoToast" class="undo-toast"></div>

    <!-- FullCalendar JS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <!-- Leaflet JS for OpenStreetMap -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="storage.js"></script>
    <script src="activity-storage.js"></script>
    <script src="activity-tracker.js"></script>
    <script src="activity-stats.js"></script>
    <script src="activity-ui.js"></script>
    <script type="module" src="undo-system.js"></script>
    <script src="mistral-agent.js"></script>
    <script src="task-manager.js"></script>
    <script src="alarm-system.js"></script>
    <script src="calendar-integration.js"></script>
    <script src="sound-system.js"></script>
    <script src="tavily-search.js"></script>
    <script src="gps-navigation.js"></script>
    <script src="weather.js"></script>
    <script src="action-wrapper.js"></script>
    <script src="script-response-handler.js"></script>
    <script src="script.js"></script>
    <script src="script-task-popup.js"></script>
</body>
</html>
